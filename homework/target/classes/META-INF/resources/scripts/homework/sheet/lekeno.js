"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();define(function(require,exports,module){var e=require("common/react/react"),t=require("common/react/react-dom"),n=require("common/react/react-utils"),r=(n.cx,require("./imgview")),a=require("jquery"),o=require("utils"),s=require("dialog");require("common/ui/ui-autocomplete/ui-autocomplete");var l=e.Component,i=(e.PropTypes,function(t){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.handleChange=t.handleChange.bind(t),t}return _inherits(n,t),_createClass(n,[{key:"componentWillReceiveProps",value:function(e){this.props.pageId!=e.pageId&&(this.refs.select.value="0")}},{key:"handleChange",value:function(e){if(this.props.onChange){var t=parseInt(e.target.value);this.props.onChange(t)}}},{key:"render",value:function(){var t=this.props.homeworks;return e.createElement("select",{ref:"select",onChange:this.handleChange},e.createElement("option",{value:"0"},"请选择作业"),t.map(function(t){var n=t.className+" "+t.teacherName+" "+t.closeTime;return e.createElement("option",{key:t.homeworkId,value:t.homeworkId,title:n},n)}))}}]),n}(l)),c=function(t){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={homeworkId:e.homeworkId},t}return _inherits(n,t),_createClass(n,[{key:"componentWillReceiveProps",value:function(e){this.props.homeworkId!=e.homeworkId&&(this.setState({homeworkId:e.homeworkId}),this.refs.ipt&&a(this.refs.ipt).autocomplete("destroy"))}},{key:"componentDidUpdate",value:function(){var e=this,t=this.props.homeworkId;a(this.refs.ipt).autocomplete({url:"users.htm?homeworkId="+t,nameKey:"userName",minLen:1,textFn:function(e){if(e){var t=e.isSubmit?"(已提交)":"",n=e.stuno?"("+e.stuno+")":"";return""+e.lekeNo+n+" "+e.userName+" "+e.className+t}return""},onChange:function(t){e.props.onChange&&e.props.onChange(t)}})}},{key:"render",value:function(){var t=!(this.state.homeworkId>0);return e.createElement("input",{ref:"ipt",type:"text",style:{width:282},disabled:t,placeholder:"请输入姓名/乐号/学号"})}}]),n}(l),u=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,t),_createClass(n,[{key:"render",value:function(){return e.createElement("div",{className:"student"},e.createElement("i",{className:"icon-student"}),e.createElement("span",null,"学生：",this.props.children))}}]),n}(l),h=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return _inherits(n,t),_createClass(n,[{key:"render",value:function(){return e.createElement("div",{className:"reason"},e.createElement("i",{className:"icon-reason"}),e.createElement("span",null,"异常原因：",this.props.children))}}]),n}(l),m=function(t){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.state={pageId:e.pageId,imgs:[],homeworkId:0,homeworkDtlId:0,lekeNo:null,stuno:null,userId:0,userName:"",homeworks:[]},t.fillCurrPage(e.pageId),t.handleJump=t.handleJump.bind(t),t.handleSave=t.handleSave.bind(t),t.handleHomeworkChange=t.handleHomeworkChange.bind(t),t.handleUserNameChange=t.handleUserNameChange.bind(t),t}return _inherits(n,t),_createClass(n,[{key:"fillCurrPage",value:function(e){a.post("get.htm",{pageId:e}).done(function(e){e.success&&this.setState(e.datas)}.bind(this))}},{key:"doNextPage",value:function(e){e?this.fillCurrPage(e):s.alert("已经是最后一个").done(function(){window.close()})}},{key:"handleHomeworkChange",value:function(e){this.setState({homeworkId:e,homeworkDtlId:0,userId:0,userName:""})}},{key:"handleUserNameChange",value:function(e){e?this.setState(e):this.setState({homeworkDtlId:0,userId:0,userName:""})}},{key:"handleJump",value:function(){var e=this.state.pageId;a.post("next.htm",{pageId:e}).done(function(e){this.doNextPage(e.datas.nextPageId)}.bind(this))}},{key:"handleSave",value:function(){var e=this.state,t=e.homeworkId,n=e.userId;if(!(t>0))return void o.Notice.alert("请选择作业");if(!(n>0))return void o.Notice.alert("请选择学生");var r=this.state,s={pageId:r.pageId,lekeNo:r.lekeNo,stuno:r.stuno,userId:r.userId,userName:r.userName,homeworkId:r.homeworkId,homeworkDtlId:r.homeworkDtlId},l=JSON.stringify(s);a.post("save.htm",{dataJson:l}).done(function(e){e.success&&(o.Notice.alert("匹配成功！"),this.doNextPage(e.datas.nextPageId))}.bind(this))}},{key:"render",value:function(){var t=this.state,n=t.pageId,a=t.imgs,o=(t.userName,t.homeworks),s=t.homeworkId;return e.createElement("div",null,e.createElement("div",{className:"c-sheet-show"},e.createElement(r,{imgs:a})),e.createElement("div",{className:"c-sheet-operation"},e.createElement("h5",{className:"head"},"异常处理"),e.createElement("div",{className:"con"},e.createElement(u,null,"未知"),e.createElement(h,null,"身份异常"),e.createElement("ul",{className:"c-abnormal-account"},e.createElement("li",null,e.createElement("label",null,"作业："),e.createElement(i,{homeworks:o,pageId:n,onChange:this.handleHomeworkChange})),e.createElement("li",null,e.createElement("label",null,"学生："),e.createElement(c,{homeworkId:s,onChange:this.handleUserNameChange}))),e.createElement("div",{className:"btns"},e.createElement("button",{className:"u-btn u-btn-nm u-btn-bg-turquoise",onClick:this.handleSave},"提交"),e.createElement("button",{className:"u-btn u-btn-nm u-btn-bg-gray",onClick:this.handleJump},"暂不处理")))))}}]),n}(l);t.render(e.createElement(m,{pageId:firstPageId}),document.getElementById("container"))});