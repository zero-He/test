"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}();define(function(require,exports,module){var e=require("common/react/react"),t=require("common/react/react-dom"),n=require("common/react/react-utils"),s=n.cx,r=require("./imgview"),a=require("jquery"),o=(require("utils"),require("dialog")),l=e.Component,i=e.PropTypes,c=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],u=["√","X"],h=function(t){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e));return t.state={answers:[]},t.handlePosition=t.handlePosition.bind(t),t}return _inherits(n,t),_createClass(n,[{key:"componentWillReceiveProps",value:function(e){this.setState({answers:[]})}},{key:"handleChange",value:function(e){var t=this.state.answers,n=t.indexOf(e);this.props.multi?n>=0?t.splice(n,1):t.push(e):t=n>=0?[]:[e],this.setState({answers:t}),this.props.result&&(this.props.result.answers=t)}},{key:"handlePosition",value:function(){this.props.onPosition&&this.props.onPosition(this.props.zone)}},{key:"render",value:function(){var t=this,n=this,r=this.props.judge?u:c,a=this.props,o=a.qno,l=a.answers,i=this.state.answers;return e.createElement("li",null,e.createElement("dfn",null,o),l.map(function(a,o){var l=i.indexOf(a)>=0;return e.createElement("span",{key:a,className:s("item",{active:l}),onClick:t.handleChange.bind(n,a)},r[o])}),e.createElement("span",{key:"pos",className:"pos",onClick:this.handlePosition}))}}]),n}(l);h.propTypes={no:i.string,judge:i.bool,multi:i.bool};var p=function(t){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e));return t.state={score:null},t.handleChange=t.handleChange.bind(t),t.handlePosition=t.handlePosition.bind(t),t}return _inherits(n,t),_createClass(n,[{key:"componentWillReceiveProps",value:function(e){this.setState({score:null}),this.refs.select.value=""}},{key:"handleChange",value:function(e){var t=e.target.value||null;this.setState({score:t}),this.props.result&&(this.props.result.score=parseInt(t))}},{key:"handlePosition",value:function(){this.props.onPosition&&this.props.onPosition(this.props.zone)}},{key:"render",value:function(){for(var t=this.props,n=t.qno,s=t.maxScore,r=[],a=0;s>=a;a++)r.push(e.createElement("option",{key:a,value:a},a,"分"));return e.createElement("li",null,e.createElement("dfn",null,n),e.createElement("select",{ref:"select",onChange:this.handleChange},r),e.createElement("span",{key:"pos",className:"pos",onClick:this.handlePosition}))}}]),n}(l),m=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return _inherits(n,t),_createClass(n,[{key:"render",value:function(){return e.createElement("div",{className:"student"},e.createElement("i",{className:"icon-student"}),e.createElement("span",null,"学生：",this.props.children))}}]),n}(l),d=function(t){function n(){return _classCallCheck(this,n),_possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return _inherits(n,t),_createClass(n,[{key:"render",value:function(){return e.createElement("div",{className:"reason"},e.createElement("i",{className:"icon-reason"}),e.createElement("span",null,"异常原因：",this.props.children))}}]),n}(l),f=function(t){function n(e){return _classCallCheck(this,n),_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e))}return _inherits(n,t),_createClass(n,[{key:"render",value:function(){this.props.rules;return e.createElement("div",{className:"c-abnormal-fill"},e.createElement("ul",{className:"lists"},this.props.children))}}]),n}(l),v=function(t){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e));return t.state={bookId:e.bookId,imgs:[],rules:[],userName:"",errorNo:"",results:[],zone:null},t.fillCurrBook(e.bookId),t.handleJump=t.handleJump.bind(t),t.handleSave=t.handleSave.bind(t),t.handlePosition=t.handlePosition.bind(t),t}return _inherits(n,t),_createClass(n,[{key:"fillCurrBook",value:function(e){a.post("get.htm",{bookId:e}).done(function(e){e.success&&this.setState(e.datas)}.bind(this))}},{key:"doNextBook",value:function(e){e?this.fillCurrBook(e):o.alert("已经是最后一个").done(function(){window.close()})}},{key:"handleJump",value:function(){var e=this.state.bookId;a.post("next.htm",{bookId:e}).done(function(e){this.doNextBook(e.datas.nextBookId)}.bind(this))}},{key:"handleSave",value:function(){var e=this.state,t=e.bookId,n=e.results,s=JSON.stringify(n);a.post("save.htm",{bookId:t,dataJson:s}).done(function(e){e.success&&this.doNextBook(e.datas.nextBookId)}.bind(this))}},{key:"handlePosition",value:function(e){this.refs.imgview&&this.refs.imgview.handleDraw&&this.refs.imgview.handleDraw(e)}},{key:"render",value:function(){var t=this,n=this,s=this.state,a=s.bookId,o=s.imgs,l=s.rules,i=s.userName,c=s.errorNo,u=s.zone,v=void 0,b=void 0;return"20302"===c?(v="",b=e.createElement("div",{className:"c-abnormal-match"},e.createElement("p",null,"1. 学生",e.createElement("span",{className:"s-c-orange"},"填涂客观题答案超过设置的正确答案数量"),"，如单选题填涂多个答案；"),e.createElement("p",null,"2. 学生",e.createElement("span",{className:"s-c-orange"},"未在规定区域答题"),"，如超出答题区等；"),e.createElement("p",null,"3. 老师",e.createElement("span",{className:"s-c-orange"},"未填涂主观题打分框"),"，或者填涂不规范疑似未填涂；"),e.createElement("p",null,"4. 老师",e.createElement("span",{className:"s-c-orange"},"填涂多个主观题打分框"),"。"))):(v="",b=e.createElement("div",{className:"c-abnormal-match"},e.createElement("p",null,"题目",e.createElement("span",{className:"s-c-orange"},"得分为0分，疑似异常"),"；"),e.createElement("p",null,"异常原因：学生填涂不规范，",e.createElement("span",{className:"s-c-orange"},"如未填涂，填涂过淡，填涂区域小"),"。"))),e.createElement("div",null,e.createElement("div",{className:"c-sheet-show"},e.createElement(r,{ref:"imgview",imgs:o,index:u&&u.idx?u.idx-1:null})),e.createElement("div",{className:"c-sheet-operation"},e.createElement("h5",{className:"head"},"异常处理"),e.createElement("div",{className:"con"},e.createElement(m,null,i),e.createElement(d,null,v),b,e.createElement(f,null,l.map(function(s,r){var o=n.state.results.filter(function(e){return e.questionId==s.qid})[0];return"1"==s.rangeType?e.createElement(h,_extends({key:a+r},s,{result:o,onPosition:t.handlePosition})):"11"==s.rangeType?(o.score=0,e.createElement(p,_extends({key:a+r},s,{result:o,onPosition:t.handlePosition}))):e.createElement("li",{key:a+r},s.title)})),e.createElement("div",{className:"btns"},e.createElement("button",{className:"u-btn u-btn-nm u-btn-bg-turquoise",onClick:this.handleSave},"提交"),e.createElement("button",{className:"u-btn u-btn-nm u-btn-bg-gray",onClick:this.handleJump},"暂不处理")))))}}]),n}(l);t.render(e.createElement(v,{bookId:firstBookId}),document.getElementById("container"))});