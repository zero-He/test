define(function (require, exports, module) {
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function scoreToLevel(e){if(null==e||void 0==e)return 5;for(var t=0;t<5;t++)if(e>=level_mins[t])return t;return 4}function buildClassScoreBar(e,t,a){return{color:["#5b9bd5","#8bc036","#ffbe54"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{selectedMode:!1,data:["最高分","最低分"]},grid:{top:60,left:120,right:120,bottom:0,containLabel:!0},xAxis:[{type:"category",data:[""]}],yAxis:[{type:"value",max:100,splitNumber:10,axisLabel:{formatter:"{value} 分"}}],series:[{name:"平均分",type:"bar",barWidth:"40%",data:[toFixed(e,1)]},{name:"最高分",type:"line",data:[toFixed(t,1)],symbolSize:10,markPoint:{silent:!0,data:[{type:"max",name:"最高分"}]}},{name:"最低分",type:"line",data:[toFixed(a,1)],symbolSize:10,markPoint:{silent:!0,data:[{type:"min",name:"最低分"}]}}]}}function buildScorePie(e,t,a,n,r){var l=arguments,s=level_names.map(function(e,t){return{name:e,value:l[t]}});return{color:["#2fbd68","#74d64b","#5cc0ff","#ffcd61","#ff6661"],legend:{bottom:20,data:level_names},tooltip:{formatter:"有成绩总人数："+(e+t+a+n+r)+"<br />{b}人数：{c}（{d}%）"},series:[{type:"pie",center:["50%","43%"],radius:["40%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!0,formatter:"{b}:{c}人,{d}%",textStyle:{fontSize:16,fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:s}]}}function buildScoreTrend(e,t,a){var n=[],r=[],l=[];return t&&(t=t.map(function(e){return null!=e?e:"-"}),r.push("#ed7d31"),l.push("我的得分"),n.push({name:"我的得分",type:"line",data:t,showAllSymbol:!0})),a&&(a=a.map(function(e){return null!=e?e:"-"}),r.push("#5b9bd5"),l.push("班级得分"),n.push({name:"班级得分",type:"line",data:a,showAllSymbol:!0})),{color:r,tooltip:{trigger:"axis"},legend:{selectedMode:!1,data:l},dataZoom:[{type:"inside"},{}],xAxis:{type:"category",data:e},yAxis:{type:"value",max:100,interval:10,axisLabel:{formatter:"{value} 分"}},series:n}}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),React=require("common/react/react"),ReactChart=require("common/react/ReactChart"),ReactPieChart=require("../common/ReactPieChart"),_require=require("../utils/number"),toFixed=_require.toFixed,toRate=_require.toRate,Dialog=require("dialog"),Utils=require("utils"),Section=require("../common/Section"),KnoGraspTable=require("../common/KnoGraspTable"),level_names=["优秀","良好","及格","较差","危险"],level_mins=[85,70,60,45,0],AnalyseResult=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.query,a=e.view;return null==a?React.createElement("div",{className:"m-mask"},React.createElement("div",{className:"con"},React.createElement("i",null),React.createElement("div",null,"数据加载中"))):0==a.success?React.createElement("div",{className:"m-tips"},React.createElement("i",null),React.createElement("span",null,a.message)):React.createElement("div",{className:"c-analayse"},React.createElement(SummaryInfo,{id:"ach_summary",view:a}),React.createElement(ScoreTrendInfo,{id:"ach_scoretrend",view:a,query:t}),React.createElement(ClassRankInfo,{id:"ach_classrank",view:a,query:t}),React.createElement(KnoGraspInfo,{id:"ach_knograsp",view:a,query:t}))}}]),t}(React.Component),SummaryInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.view,t=e.summary,a=t.avgScore,n=t.maxScore,r=t.minScore,l=t.totalNum,s=t.otherNum,c=t.levelA,o=t.levelB,i=t.levelC,u=t.levelD,m=t.levelE,p=l-s,d='敬爱的<span class="fc-green">'+e.userName+"</span>老师：",f='在此期间，本班级的学科平均分为<span class="fc-green">'+toFixed(a,1)+"</span>分，";return f+='最高分<span class="fc-green">'+toFixed(n,1)+"</span>分，",f+='最低分<span class="fc-orange">'+toFixed(r,1)+"</span>分，",f+='班级整体表现<span class="fc-orange">'+level_names[scoreToLevel(a)]+"</span>；",f+='本班共有学生<span class="fc-green">'+l+"</span>人，",f+='其中成绩优秀<span class="fc-green">'+c+"</span>人，",f+='占比<span class="fc-green">'+toRate(c,p,1)+"%</span>，",f+='良好<span class="fc-green">'+o+"</span>人，",f+='占比<span class="fc-green">'+toRate(o,p,1)+"%</span>，",f+='及格<span class="fc-green">'+i+"</span>人，",f+='占比<span class="fc-green">'+toRate(i,p,1)+"%</span>，",f+='较差<span class="fc-orange">'+u+"</span>人，",f+='占比<span class="fc-orange">'+toRate(u,p,1)+"%</span>，",f+='危险<span class="fc-orange">'+m+"</span>人，",f+='占比<span class="fc-orange">'+toRate(m,p,1)+"%</span>。",React.createElement("section",{id:this.props.id,className:"c-paragraph"},React.createElement("section",{className:"title",dangerouslySetInnerHTML:{__html:d}}),React.createElement("section",{className:"con",dangerouslySetInnerHTML:{__html:f}}),React.createElement("div",{className:"c-layout",style:{marginTop:35}},React.createElement("div",{className:"left",style:{width:"40%"}},React.createElement(ReactChart,{className:"maps",option:buildClassScoreBar(a,n,r)})),React.createElement("div",{className:"right",style:{width:"50%"}},React.createElement(ReactChart,{className:"maps",option:buildScorePie(c,o,i,u,m)}))))}}]),t}(React.Component),ScoreTrendInfo=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.handleChangeType=function(e){a.setState({idx:e})},a.renderTabs=function(e){if(!(e&&e.length>1))return null;var t=a.state.idx;return React.createElement("div",{className:"maps-tab"},React.createElement("ul",null,e.map(function(e,n){return React.createElement("li",{key:n,className:t==n?"active":"",onClick:function(){return a.handleChangeType(n)}},e.label)})))},a.state={idx:0},a}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.view.trends;if(!e||!e.length)return null;var t=e[this.state.idx],a=t.names,n=t.selfs,r=t.klass;return React.createElement(Section,{title:"班级成长走势"},this.renderTabs(e),React.createElement(ReactChart,{className:"maps",option:buildScoreTrend(a,n,r)}))}}]),t}(React.Component),ClassRankInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"buildLevel",value:function(e,t,a){var n=this.props.query,r="./klass-score-detail/"+n.klassId+"-"+n.cycleId;return t=t.filter(function(e){return e.level==a}),t.map(function(n,l){return React.createElement("tr",null,0==l?React.createElement("td",{className:"lv-"+a,rowSpan:t.length},e,"(",t.length,"人)"):null,React.createElement("td",null,n.index),React.createElement("td",{className:"operation"},a<=5?React.createElement("a",{href:r+"-"+n.userId+".htm",target:"_blank"},n.userName):React.createElement("span",null,n.userName)),React.createElement("td",null,null!=n.score?toFixed(n.score,1):"--"))})}},{key:"render",value:function(){var e=this,t=this.props.view.scoreRanks;t.forEach(function(e,t){e.score=toFixed(e.score,1),e.level=scoreToLevel(e.score)+1});for(var a=1e4,n=0,r=0;r<t.length;r++){var l=t[r];null!=l.score?(l.score<a&&(n++,a=l.score),l.index=n):l.index="--"}var s=["优秀","良好","及格","较差","危险","无成绩"];return React.createElement(Section,{title:"班级成绩排行"},React.createElement("div",{className:"ranklist"},React.createElement("div",{className:"m-table m-table-center"},React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:150}},"层级"),React.createElement("th",null,"排名"),React.createElement("th",null,"姓名"),React.createElement("th",null,"分数"))),React.createElement("tbody",null,s.map(function(a,n){return e.buildLevel(a,t,n+1)}))))),React.createElement("span",{className:"tips"},"注：点击学生姓名可查看该生学习分析报告"))}}]),t}(React.Component),KnoGraspInfo=function(e){function t(){var e,a,n,r;_classCallCheck(this,t);for(var l=arguments.length,s=Array(l),c=0;c<l;c++)s[c]=arguments[c];return a=n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),n.markLevels=function(e){e.filter(function(e){return e.classRate>=85}).forEach(function(e){return e.level=1}),e.filter(function(e){return e.classRate<50}).forEach(function(e){return e.level=3}),e.filter(function(e){return!e.level}).forEach(function(e){return e.level=2})},r=a,_possibleConstructorReturn(n,r)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.query,t=e.klassId.split("-"),a=t[0],n=t[1],r=this.props.view,l=r.knoRates;return l&&l.length?(this.markLevels(l),React.createElement(Section,{id:this.props.id,title:"知识点掌握程度",help:Leke.domain.staticServerName+"/pages/help-center/diag/zw-cd.html"},React.createElement(KnoGraspTable,{knoRates:l,columns:"name,klassRate,level",increase:"hd"!=Leke.device&&101==Leke.user.currentRoleId,classId:a,subjectId:n}))):null}}]),t}(React.Component);module.exports=AnalyseResult;
});