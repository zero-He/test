define(function (require, exports, module) {
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),React=require("common/react/react"),ReactDOM=require("common/react/react-dom"),$=require("jquery"),_require=require("common/react/react-utils"),cx=_require.cx,ReactChart=require("common/react/ReactChart"),ScoreChartConfig=require("./ScoreChartConfig"),KnoGraspTable=require("../common/KnoGraspTable"),MicroView=require("../common/MicroView"),_require2=require("./ScoreComponents"),ScoreReportQuery=_require2.ScoreReportQuery,ScoreTrendChart=_require2.ScoreTrendChart,_require3=require("./helper"),toFixed=_require3.toFixed,toRate=_require3.toRate,toLevel=_require3.toLevel,levelNames=_require3.levelNames,toLevelName=_require3.toLevelName,_require4=require("../utils/number"),toFixed=_require4.toFixed,toRate=_require4.toRate,Section=require("../common/Section"),PersonSummary=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"renderExplain",value:function(e,t,a){var r=e.totalNum,n=e.submitNum,c=e.delayNum,s=e.correctNum,l=e.levelA,o=e.levelB,m=e.levelC,i=e.levelD,u=e.levelE,p=e.queNum,d=e.errNum;return React.createElement("p",{className:"details"},"在此期间内，",a?"您":React.createElement("span",{className:"colored"},t,"同学"),"应交作业",React.createElement("span",{className:"colored"},r),"份， 正常提交作业",React.createElement("span",{className:"colored"},n-c),"份，占比",React.createElement("span",{className:"colored"},toRate(n-c,r,1),"%"),"， 延交作业",React.createElement("span",{className:"pointed"},c),"份，占比",React.createElement("span",{className:"pointed"},toRate(c,r,1),"%"),"， 未交作业",React.createElement("span",{className:"pointed"},r-n),"份，占比",React.createElement("span",{className:"pointed"},toRate(r-n,r,1),"%"),"； 已批改作业",React.createElement("span",{className:"colored"},s),"份， 其中成绩优秀",React.createElement("span",{className:"colored"},l),"份，占比",React.createElement("span",{className:"colored"},toRate(l,s,1),"%"),"， 良好",React.createElement("span",{className:"colored"},o),"份，占比",React.createElement("span",{className:"colored"},toRate(o,s,1),"%"),"， 及格",React.createElement("span",{className:"colored"},m),"份，占比",React.createElement("span",{className:"colored"},toRate(m,s,1),"%"),"， 较差",React.createElement("span",{className:"pointed"},i),"份，占比",React.createElement("span",{className:"pointed"},toRate(i,s,1),"%"),"， 危险",React.createElement("span",{className:"pointed"},u),"份，占比",React.createElement("span",{className:"pointed"},toRate(u,s,1),"%"),"； 共做题",React.createElement("span",{className:"colored"},p),"道，错题",React.createElement("span",{className:"pointed"},toFixed(d,1)),"道， 得分率",React.createElement("span",{className:"colored"},toRate(p-d,p,1),"%"),"。")}},{key:"render",value:function(){var e=this.props,t=e.summary,a=e.userName,r=e.myself,n=t.submitNum,c=t.delayNum,s=t.totalNum,l=t.levelA,o=t.levelB,m=t.levelC,i=t.levelD,u=t.levelE;return React.createElement("div",{className:"summary"},React.createElement("p",{className:"tittle"},"成绩分析"),r?React.createElement("p",null,"亲爱的",React.createElement("span",{className:"colored"},a),"同学："):null,this.renderExplain(t,a,r),React.createElement("div",{className:"maps"},React.createElement("div",{className:"mapcontainer"},React.createElement(ReactChart,{className:"mapitem left2",option:ScoreChartConfig.buildSubmitPie(n-c,c,s-n,"份")}),React.createElement(ReactChart,{className:"mapitem right2",option:ScoreChartConfig.buildScorePie(l,o,m,i,u,"份")}))))}}]),t}(React.Component),OverallInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.overall,a=e.subjScores,r=e.isUnit;if(null==t)return null;var n=t.score,c=t.rank,s=t.total,l=t.maxes1,o=t.maxes2,m=t.mines1,i=t.mines2,u=toRate(s-c,s,1),p=a.map(function(e){return e.label}),d=a.map(function(e){return e.self}),R=a.map(function(e){return e.klass});return React.createElement("div",{className:"subject-ana"},React.createElement("p",{className:"tittle"},"学科优劣势分析"),React.createElement("div",{className:"maps"},React.createElement("div",{className:"mapcontainer"},React.createElement(ReactChart,{className:"mapitem left2",option:ScoreChartConfig.buildScoreRadar(p,d,r?null:R)}),React.createElement("div",{className:"mapitem right2"},React.createElement(ReactChart,{className:"inner",option:ScoreChartConfig.buildOverallScore(n,r?null:u)}),React.createElement("p",null,"您的全科综合得分为",React.createElement("span",{className:"colored"},toFixed(n,1),"分"),"，表现",React.createElement("span",{className:"colored"},toLevelName(n)),"；",r?null:React.createElement("span",null,"班级排名第",React.createElement("span",{className:"colored"},c),"，领先全班",React.createElement("span",{className:"colored"},u,"%"),"的同学；")),React.createElement("p",null,"相比自己综合得分短板学科为",React.createElement("span",{className:"pointed"},m),"，长板学科为",React.createElement("span",{className:"colored"},l),"；",r?null:React.createElement("span",null,"相比班级各科得分劣势学科为",React.createElement("span",{className:"pointed"},i),"，相对优势学科为",React.createElement("span",{className:"colored"},o),"；"),r?React.createElement("span",null,"请加强短板学科的学习训练，弥补不足，齐头并进。"):React.createElement("span",null,"请加强短板、劣势学科的学习训练，弥补不足，齐头并进。"))))))}}]),t}(React.Component),ScoreCompared=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.subjScores,a=e.rptType;if(null==t)return null;var r=0,n=0,c=0,s=[],l=ScoreChartConfig.Labels.cycles[a];t.forEach(function(e){if(e.self&&e.prev){e.self-3>e.prev?n++:e.self+3<e.prev?c++:r++;var t=toLevel(e.self),a=toLevel(e.prev);t<=a-2?(s.push(React.createElement("span",null,e.label,React.createElement("span",{className:"colored"},"上升劲猛"),"，")),s.push(React.createElement("span",null,"从",levelNames[a-1],"升上",levelNames[t-1],"；"))):t>=a+2&&(s.push(React.createElement("span",null,e.label,React.createElement("span",{className:"pointed"},"下降严重"),"，")),s.push(React.createElement("span",null,"从",levelNames[a-1],"跌入",levelNames[t-1],"；")))}}),s.length>0&&s.unshift(React.createElement("span",null,"2、相较于",l[0],"，",l[1]));var o=t.map(function(e){return e.label}),m=t.map(function(e){return null!=e.self?e.self:"-"}),i=t.map(function(e){return null!=e.prev?e.prev:"-"});return React.createElement("div",{className:"subject-compare"},React.createElement("p",{className:"tittle"},"学科成绩对比分析"),React.createElement("div",{className:"maps"},React.createElement(ReactChart,{className:"single",option:ScoreChartConfig.buildScoreCompBar(a,o,m,i)}),React.createElement("p",null,"1、相较于",l[0],"，",l[1],"有",React.createElement("span",{className:"pointed"},c,"门"),"功课呈",React.createElement("span",{className:"pointed"},"下降趋势"),"；",React.createElement("span",{className:"colored"},n,"门"),"呈",React.createElement("span",{className:"colored"},"上升趋势"),"；",r,"门功课持平"),React.createElement("p",null,s)))}}]),t}(React.Component),ScoreTrendInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.trends,a=e.subjId;return t&&t.length?React.createElement("div",{className:"syn-trend"},React.createElement("p",{className:"tittle"},a>0?"学科成长走势":"综合成绩走势分析"),React.createElement(ScoreTrendChart,{trends:this.props.trends})):null}}]),t}(React.Component),ComboScoreRank=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"markRankIndex",value:function(e,t){for(var a=1e4,r=0,n=0;n<e.length;n++){var c=e[n][t];c<a&&(r++,a=c),e[n].index=r}}},{key:"renderHead",value:function(e,t){if(t>0){var a=e.filter(function(e){return e.id==t})[0];return React.createElement("tr",null,React.createElement("th",{key:"index"},"名次"),React.createElement("th",{key:"userName"},"姓名"),React.createElement("th",{key:"score"},a.name,"成绩"))}return React.createElement("tr",null,React.createElement("th",{key:"index"},"名次"),React.createElement("th",{key:"userName"},"姓名"),React.createElement("th",{key:"0",className:cx({chosen:0==t})},"综合"),e.map(function(e){return React.createElement("th",{key:e.id,className:cx({chosen:e.id==t})},e.name)}))}},{key:"renderBody",value:function(e,t,a,r){return e.map(function(e,n){return n>=10&&e.userId!=r?null:a>0?React.createElement("tr",{key:e.userId},React.createElement("td",{key:"index"},e.index),React.createElement("td",{key:"userName",className:cx({self:e.userId==r})},e.userName),React.createElement("td",{key:"score"},toFixed(e[a],1))):React.createElement("tr",{key:e.userId},React.createElement("td",{key:"index"},e.index),React.createElement("td",{key:"userName",className:cx({self:e.userId==r})},e.userName),React.createElement("td",{key:"0",className:cx({chosen:0==a})},toFixed(e.score,1)),t.map(function(t){var r=e[t.id];return r=null==r||void 0==r?"--":toFixed(r,1),React.createElement("td",{key:t.id,className:cx({chosen:t.id==a})},r)}))})}},{key:"render",value:function(){var e=this.props,t=e.scoreRanks,a=e.subjs,r=e.subjId,n=e.userId;if(void 0==t||null==t)return null;this.markRankIndex(t,r);var c=this.renderHead(a,r),s=this.renderBody(t,a,r,n);return React.createElement("div",{className:"class-rank"},React.createElement("p",{className:"tittle"},"班级",r>0?"":"综合","成绩TOP10"),React.createElement("div",{className:"m-table m-table-center"},React.createElement("table",null,React.createElement("thead",null,c),React.createElement("tbody",null,s))))}}]),t}(React.Component),KnoGraspInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"markLevels",value:function(e){e.forEach(function(e){e.selfRate>=85?e.level=1:e.selfRate>=50?e.level=2:e.level=3})}},{key:"render",value:function(){var e=this.props,t=e.knoRates,a=e.myself,r=e.isUnit;if(!t||!t.length)return null;this.markLevels(t);var n="name,totalNum,selfRate,klassRate,level";return a&&"hd"!=Csts.device&&(n="name,totalNum,selfRate,klassRate,level,wrong,exercise"),r&&(n=n.replace("klassRate,","")),React.createElement(Section,{id:this.props.id,title:"知识点掌握程度",help:Leke.domain.staticServerName+"/pages/help-center/diag/zw-cd.html"},React.createElement("div",{className:"knowledgepoint"},React.createElement(KnoGraspTable,{knoRates:t,columns:n})))}}]),t}(React.Component),MicroRecommend=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){if("hd"==Csts.device)return null;var e=this.props.datas;return null==e||void 0==e||0==e.length?null:React.createElement("div",{className:"courserecommend"},React.createElement("span",{className:"tittle"},"微课推荐"),React.createElement(MicroView,{datas:e}))}}]),t}(React.Component),PersonAnalysis=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={loading:!1,scope:null,subjId:null,view:null},a.handleChangeQuery=a.handleChangeQuery.bind(a),a}return _inherits(t,e),_createClass(t,[{key:"handleChangeQuery",value:function(e,t,a){this.setState({loading:!0}),$.post("person-score-data.htm",{classId:e,subjectId:t,cycleId:a}).done(function(e){this.setState({loading:!1,subjId:t,view:e.datas.view})}.bind(this))}},{key:"renderBody",value:function(){var e=this.state,t=e.subjId,a=e.loading,r=e.view;return null==r||1==a?React.createElement("div",{className:"m-mask"},React.createElement("div",{className:"con"},React.createElement("i",null),React.createElement("div",null,"数据加载中"))):0==r.success?React.createElement("div",{className:"m-tips"},React.createElement("i",null),React.createElement("span",null,r.message)):0==r.summary.correctNum?React.createElement(PersonSummary,{summary:r.summary,userName:Csts.userName,myself:!0}):[React.createElement(PersonSummary,{summary:r.summary,userName:Csts.userName,myself:!0}),React.createElement(OverallInfo,{overall:r.overall,subjScores:r.subjScores,isUnit:r.isUnit}),React.createElement(ScoreTrendInfo,{trends:r.trends,subjId:t}),React.createElement(ScoreCompared,{subjScores:r.subjScores,rptType:r.rptType}),React.createElement(ComboScoreRank,{scoreRanks:r.scoreRanks,subjs:r.subjs,subjId:t,userId:Leke.user.userId}),React.createElement(KnoGraspInfo,{knoRates:r.knoRates,myself:!0,isUnit:r.isUnit}),t>0?React.createElement(MicroRecommend,{datas:r.micros}):null]}},{key:"render",value:function(){var e=Csts,t=e.types,a=e.zones,r=e.mode;e.view,e.userName;return React.createElement("div",{className:"analysis"},React.createElement(ScoreReportQuery,{types:t,zones:a,hideZone:1==r,onChange:this.handleChangeQuery}),React.createElement("div",{className:"c-syn-subj"},this.renderBody()))}}]),t}(React.Component),DetailAnalysis=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"renderBody",value:function(){var e=Csts,t=e.subjId,a=e.view;return 0==a.success?React.createElement("div",{className:"m-tips"},React.createElement("i",null),React.createElement("span",null,a.message)):0==a.summary.correctNum?React.createElement(PersonSummary,{summary:a.summary,userName:Csts.userName,myself:!1}):React.createElement("div",null,React.createElement(PersonSummary,{summary:a.summary,userName:Csts.userName,myself:!1}),React.createElement(ScoreTrendInfo,{trends:a.trends,subjId:t}),React.createElement(KnoGraspInfo,{knoRates:a.knoRates,myself:!1,isUnit:!1}))}},{key:"render",value:function(){return React.createElement("div",{className:"analysis"},React.createElement("div",{className:"c-syn-subj"},this.renderBody()))}}]),t}(React.Component),conatiner=document.getElementById("container");Csts.view?ReactDOM.render(React.createElement(DetailAnalysis,null),container):ReactDOM.render(React.createElement(PersonAnalysis,null),container);
});