define(function (require, exports, module) {
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),React=require("common/react/react"),ReactDOM=require("common/react/react-dom"),LekeDate=require("common/base/date"),_require=require("common/react/react-utils"),cx=_require.cx,ReactChart=require("common/react/ReactChart"),SimpleTable=require("./SimpleTable"),LessonChartConfig=require("./LessonChartConfig"),_require2=require("../utils/number"),toFixed=_require2.toFixed,toRate=_require2.toRate,Dialog=require("dialog"),ReviewOverview=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.phase,a=e.subNames,n=e.overall,l=e.exams,r=n.total,c=n.finish,s=n.portion,i=n.finish1,o=n.finish2,m=n.finish3,u=r-c-s,d=1==t?"预习":"复习",h=[{name:a[0],value:i},{name:a[1],value:o},{name:a[2],value:m}],R=[{title:"作业名称",width:"80%",field:function(e,t){return e.correctNum>0?React.createElement("a",{className:"taskname s-c-turquoise",href:"../../homework/"+e.homeworkId+".htm",title:e.homeworkName,target:"_blank"},e.homeworkName):React.createElement("span",{className:"taskname",title:e.homeworkName},e.homeworkName)}},{title:"平均分",width:"20%",field:function(e,t){return toFixed(e.avgScore,1)}}];return React.createElement("div",null,React.createElement("h3",{className:"seniortitle"},d,"情况概览"),React.createElement("div",{className:"previewsituation"},React.createElement("div",{className:"item"},React.createElement("h3",{className:"title"},d,"总体完成情况"),React.createElement(ReactChart,{className:"report",style:{height:300},option:LessonChartConfig.buildOverallFinishPie(c,s,u)}),React.createElement("p",{className:"text"},React.createElement("span",null,"本次",d,"任务应完成人数",React.createElement("span",{className:"s-c-turquoise"},r),"，"),React.createElement("span",null,"已完成人数",React.createElement("span",{className:"s-c-turquoise"},c),"，比率",React.createElement("span",{className:"s-c-turquoise"},toRate(c,r,1),"%"),"，"),React.createElement("span",null,"部分完成人数",React.createElement("span",{className:"s-c-turquoise"},s),"，比率",React.createElement("span",{className:"s-c-turquoise"},toRate(s,r,1),"%"),"，"),React.createElement("span",null,"未完成人数",React.createElement("span",{className:"s-c-tomato"},u),"，比率",React.createElement("span",{className:"s-c-tomato"},toRate(u,r,1),"%"),"。"))),React.createElement("div",{className:"item"},React.createElement("h3",{className:"title"},d,"分类完成情况"),React.createElement(ReactChart,{className:"report",style:{height:300},option:LessonChartConfig.buildCategoryFinishRadar(r,h)}),React.createElement("p",{className:"text preview"},React.createElement("span",null,a[0],d,"人数",React.createElement("span",{className:"s-c-turquoise"},i),"，比率",React.createElement("span",{className:"s-c-turquoise"},toRate(i,r,1),"%"),"；"),React.createElement("br",null),React.createElement("span",null,a[1],d,"人数",React.createElement("span",{className:"s-c-turquoise"},o),"，比率",React.createElement("span",{className:"s-c-turquoise"},toRate(o,r,1),"%"),"；"),React.createElement("br",null),React.createElement("span",null,a[2],d,"人数",React.createElement("span",{className:"s-c-turquoise"},m),"，比率",React.createElement("span",{className:"s-c-turquoise"},toRate(m,r,1),"%"),"。"),React.createElement("br",null))),React.createElement("div",{className:"item"},React.createElement("h3",{className:"title"},1==t?"预习":"课后","作业班级平均分"),React.createElement("div",{className:"average"},React.createElement(SimpleTable,{columns:R,datas:l.slice(0,5),defVal:"--"})),React.createElement("div",null,React.createElement("span",{className:"s-c-r"},"*")," 点击作业名称可查看班级作业分析报告。"))))}}]),t}(React.Component),ReviewFinished=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"handleOpenIssue",value:function(e){var t=Leke.domain.beikeServerName+"/auth/common/review/confuse.htm?courseSingleId="+ReportCst.lessonId+"&studentId="+e;Dialog.open({size:"lg",title:"预习困惑结论",url:t})}},{key:"renderIssue",value:function(e){var t=this;return 1!=e.hasIssue?React.createElement("td",null,"未提交"):React.createElement("td",null,React.createElement("a",{className:"s-c-turquoise",onClick:function(){return t.handleOpenIssue(e.userId)}},"查看"))}},{key:"renderState",value:function(e,t,a){var n=this,l=this.props.phase,r=["nocontent","defeated","succeed"];return e.map(function(e,c){return React.createElement("tr",null,0==c?t:null,React.createElement("td",null,a+c+1),React.createElement("td",null,e.userName),React.createElement("td",null,React.createElement("i",{className:r[e.state1+1]})),React.createElement("td",null,React.createElement("i",{className:r[e.state2+1]})),React.createElement("td",null,React.createElement("i",{className:r[e.state3+1]})),1===l?n.renderIssue(e):null)})}},{key:"render",value:function(){var e=this.props,t=e.phase,a=e.details,n=1==t?"预习":"复习",l=[],r=a.filter(function(e){return 2==e.state}),c=a.filter(function(e){return 1==e.state}),s=a.filter(function(e){return 0==e.state}),i=r.length,o=c.length,m=s.length;r.length>0&&(l=l.concat(this.renderState(r,[React.createElement("td",{className:"greenbg",rowSpan:i},"完成（",i,"人）")],0))),c.length>0&&(l=l.concat(this.renderState(c,[React.createElement("td",{className:"yellowbg",rowSpan:o},"部分完成（",o,"人）")],i))),s.length>0&&(l=l.concat(this.renderState(s,[React.createElement("td",{className:"redbg",rowSpan:m},"未完成（",m,"人）")],i+o)));var u=void 0;return u=1==t?React.createElement("tr",null,React.createElement("th",{style:{width:"12%"}},"状态"),React.createElement("th",{style:{width:"12%"}},"序号"),React.createElement("th",{style:{width:"15%"}},"姓名"),React.createElement("th",{style:{width:"15%"}},"课件"),React.createElement("th",{style:{width:"15%"}},"微课"),React.createElement("th",{style:{width:"15%"}},"试卷"),React.createElement("th",{style:{width:"16%"}},"预习困惑\\结论")):React.createElement("tr",null,React.createElement("th",{style:{width:"14%"}},"状态"),React.createElement("th",{style:{width:"14%"}},"序号"),React.createElement("th",{style:{width:"18%"}},"姓名"),React.createElement("th",{style:{width:"18%"}},"课件"),React.createElement("th",{style:{width:"18%"}},"试卷"),React.createElement("th",{style:{width:"18%"}},"笔记")),React.createElement("div",{className:"preparecomplete"},React.createElement("h3",{className:"seniortitle"},n,"完成详情"),React.createElement("div",{className:"m-table m-table-center"},React.createElement("table",null,React.createElement("thead",null,u),React.createElement("tbody",null,l))))}}]),t}(React.Component),BehaviorTimeline=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){function e(e,t){return t+1}function t(e,t){var a=LekeDate.format(e.start,"HH:mm:ss");return null!=e.end&&e.end>0&&(a+=" - "+LekeDate.format(e.end,"HH:mm:ss")),a}function a(e,t){if(null!=e.end&&e.end>0){var a=Math.floor(e.end/1e3)-Math.floor(e.start/1e3),n=a%60;return Math.floor(a/60)+"分"+n+"秒"}return"--"}var n=[{title:"序号",width:"10%",field:e},{title:"互动项目",width:"25%",field:"typeName"},{title:"备注",width:"25%",field:"topic"},{title:"起止时间",width:"20%",field:t},{title:"时长（分钟）",width:"20%",field:a}];return React.createElement("div",null,React.createElement("h3",{className:"seniortitle"},"课堂行为"),React.createElement(SimpleTable,{columns:n,datas:this.props.datas,defVal:"--"}))}}]),t}(React.Component),LessonEvaluate=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"renderScore",value:function(e,t){var a=toRate(t,5,1);return React.createElement("dl",{className:"e-eval-score"},React.createElement("dt",null,e,"："),React.createElement("dd",null,React.createElement("em",null,React.createElement("i",{style:{width:a+"%"}}))),React.createElement("dd",null,React.createElement("b",null,t)))}},{key:"renderEval",value:function(e,t){var a=0,n=0,l=0,r=0,c=0,s=0,i=0,o=0;return null!=t&&(c=t.userCount,s=t.professionalScore,i=t.rhythmScore,o=t.interactionScore,a=s+i+o,n=toFixed(a/3,1),l=toRate(n,5),r=toRate(t.goodCount,c,1)),React.createElement("div",{className:"item"},React.createElement("h3",{className:"title"},e),React.createElement("div",{className:"info"},React.createElement("div",{className:"fraction"},React.createElement("div",{className:"num"},n),React.createElement("dl",{className:"e-eval-score"},React.createElement("dd",null,React.createElement("em",null,React.createElement("i",{style:{width:l+"%"}}))))),React.createElement("div",{className:"rateofpraise"},React.createElement("span",null,"共",React.createElement("span",{className:"s-c-tomato"},c),"人评价"),React.createElement("br",null),React.createElement("span",null,"好评率：",React.createElement("span",{className:"s-c-tomato"},r,"%")))),React.createElement("div",{className:"table-point"},this.renderScore("教学效果",s),this.renderScore("教学态度",i),this.renderScore("课堂互动",o)))}},{key:"renderFlower",value:function(e){return React.createElement("div",{className:"item f-ml20"},React.createElement("h3",{className:"title"},"收到鲜花"),React.createElement("div",{className:"evaluatecount"},e))}},{key:"render",value:function(){var e=this.props,t=e.flower,a=e.lessonEval,n=e.teacherEval;return React.createElement("div",{className:"evaluate"},React.createElement("h3",{className:"seniortitle"},"课堂评价"),React.createElement("div",{className:"f-bfc"},this.renderEval("本课堂评价",a),React.createElement("div",{className:"vs"},"vs"),this.renderEval("累计评价",n),this.renderFlower(t)),React.createElement("div",{className:"link"},React.createElement("a",{href:"../evaluate/"+ReportCst.lessonId+".htm",target:"_blank"},"学生评价详情 ",React.createElement("i",null))))}}]),t}(React.Component),LessonTopRank=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){function e(e,a){return a<3?React.createElement("i",{className:t[a]}):a+1}var t=["gold","silver","cuprum"],a=[{title:"排名",width:"10%",field:e},{title:"姓名",width:"18%",field:"userName"},{title:"预习",width:"12%",field:"review"},{title:"课堂互动",width:"12%",field:"interact"},{title:"随堂测试",width:"12%",field:"testing"},{title:"乐豆奖惩",width:"12%",field:"reward"},{title:"综合得分",width:"12%",field:"score"}],n=encodeURIComponent(ReportCst.view.lesson.className),l=encodeURIComponent(ReportCst.view.lesson.subjectName),r=LekeDate.format(ReportCst.view.lesson.startTime,"yyyy-MM-dd HH:mm"),c=Leke.domain.chatServerName+"/auth/common/chat/chatDetail.htm?courseSingleId="+ReportCst.lessonId+"&clazzName="+n+"&subjectName="+l+"&startTime="+r;return React.createElement("div",{className:"achievementlist"},React.createElement("h3",{className:"seniortitle"},"课堂金榜"),React.createElement(SimpleTable,{columns:a,datas:this.props.datas,defVal:"--"}),React.createElement("div",{className:"link"},React.createElement("a",{className:"s-c-turquoise",href:"../behavior/"+ReportCst.lessonId+".htm",target:"_blank"},"学生课堂行为列表>>",React.createElement("i",null)),React.createElement("a",{className:"s-c-turquoise",href:c,target:"_blank"},"课堂聊天记录>>",React.createElement("i",null))))}}]),t}(React.Component),LessonExamInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.datas;if(null==e||0==e.length)return null;var t=[{title:"作业名称",width:"23%",field:function(e,t){return e.correctNum>0?React.createElement("a",{className:"s-c-turquoise",href:"../../homework/"+e.homeworkId+".htm",target:"_blank"},e.homeworkName):e.homeworkName}},{title:"提交人数(比率)",width:"7%",field:function(e,t){var a=toRate(e.finishNum,e.totalNum,1);return e.finishNum+"("+a+"%)"}},{title:"未交人数(比率)",width:"7%",field:function(e,t){var a=e.totalNum-e.finishNum;return a+"("+toRate(a,e.totalNum,1)+"%)"}},{title:"总分",width:"7%",field:function(e,t){return toFixed(e.totalScore,1)}},{title:"平均分",width:"7%",field:function(e,t){return toFixed(e.avgScore,1)}},{title:"最高分",width:"7%",field:function(e,t){return toFixed(e.maxScore,1)}},{title:"最低分",width:"7%",field:function(e,t){return toFixed(e.minScore,1)}},{title:"优秀人数(比率)",width:"7%",field:function(e,t){if(0==e.finishNum)return"--";var a=toRate(e.levelA,e.correctNum,1);return e.levelA+"("+a+"%)"}},{title:"良好人数(比率)",width:"7%",field:function(e,t){if(0==e.finishNum)return"--";var a=toRate(e.levelB,e.correctNum,1);return e.levelB+"("+a+"%)"}},{title:"及格人数(比率)",width:"7%",field:function(e,t){if(0==e.finishNum)return"--";var a=toRate(e.levelC,e.correctNum,1);return e.levelC+"("+a+"%)"}},{title:"较差人数(比率)",width:"7%",field:function(e,t){if(0==e.finishNum)return"--";var a=toRate(e.levelD,e.correctNum,1);return e.levelD+"("+a+"%)"}},{title:"危险人数(比率)",width:"7%",field:function(e,t){if(0==e.finishNum)return"--";var a=toRate(e.levelE,e.correctNum,1);return e.levelE+"("+a+"%)"}}];return React.createElement("div",null,React.createElement("h3",{className:"seniortitle"},"随堂作业"),React.createElement(SimpleTable,{columns:t,datas:e,defVal:"--"}),React.createElement("div",null,React.createElement("span",{className:"s-c-r"},"*")," 点击作业名称可查看班级作业分析报告。"))}}]),t}(React.Component),LessonAttendance=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"handleShowNames",value:function(e){var t="../attendnames/"+ReportCst.lessonId+"-"+e+".htm";Dialog.open({size:"nm",title:"名单",url:t})}},{key:"render",value:function(){var e=this.props.attend,t=e.planNum,a=e.realNum,n=e.missNum,l=e.partNum;return React.createElement("div",null,React.createElement("h3",{className:"seniortitle"},"课堂考勤"),React.createElement("div",{className:"m-table m-table-center"},React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:"25%"}},"应到人数"),React.createElement("th",{style:{width:"25%"}},"实到人数"),React.createElement("th",{style:{width:"25%"}},"非全勤人数"),React.createElement("th",{style:{width:"25%"}},"缺勤人数"))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,t),React.createElement("td",null,a),React.createElement("td",null,l>0?React.createElement("span",{className:"s-c-turquoise f-csp",onClick:this.handleShowNames.bind(this,0)},l):l),React.createElement("td",null,n>0?React.createElement("span",{className:"s-c-turquoise f-csp",onClick:this.handleShowNames.bind(this,2)},n):n))))))}}]),t}(React.Component),LessonCallInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"handleShowNames",value:function(e){var t='<div class="names">'+e.map(function(e){return"<span>"+e+"</span>"}).join("")+"</div>";Dialog.open({size:"nm",title:"名单",tpl:t})}},{key:"render",value:function(){function e(e,t){return LekeDate.format(e.start,"yyyy-MM-dd HH:mm")}function t(e,t){return 401==e.type?ReportCst.view.lesson.teacherName:"系统"}function a(e,t){var a=e.total-e.done;return 0==a?a:React.createElement("span",{className:"s-c-turquoise f-csp",onClick:n.handleShowNames.bind(n,e.unNames)},e.total-e.done)}var n=this,l=this.props.datas;if(null==l||0==l.length)return null;var r=[{title:"点名",width:"20%",field:"topic"},{title:"时间",width:"16%",field:e},{title:"发起者",width:"16%",field:t},{title:"应点到人数",width:"16%",field:"total"},{title:"实点到人数",width:"16%",field:"done"},{title:"未点到人数",width:"16%",field:a}];return React.createElement("div",null,React.createElement("h3",{className:"seniortitle"},"课堂点名"),React.createElement(SimpleTable,{columns:r,datas:l,defVal:"--"}))}}]),t}(React.Component),LessonQuickInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){function e(e,t){return t+1}function t(e,t){return LekeDate.format(e.start,"yyyy-MM-dd HH:mm")}function a(e,t){var a=toRate(e.done,e.total);return e.done+"("+a+"%)"}var n=this.props.datas;if(null==n||0==n.length)return null;var l=[{title:"序号",width:"15%",field:e},{title:"发起时间",width:"20%",field:t},{title:"类型",width:"25%",field:"topic"},{title:"在线人数",width:"20%",field:"total"},{title:"提交人数(比率)",width:"20%",field:a}];return React.createElement("div",null,React.createElement("h3",{className:"seniortitle"},"快速提问"),React.createElement(SimpleTable,{columns:l,datas:this.props.datas,defVal:"--"}))}}]),t}(React.Component),LessonReportView=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={tabIdx:e.tabIdx},a}return _inherits(t,e),_createClass(t,[{key:"handleTabChange",value:function(e){this.setState({tabIdx:e})}},{key:"render",value:function(){var e=this.state.tabIdx,t=[];if(1==e){var a=ReportCst.view.preview,n=["课件","微课","试卷"];t.push(React.createElement(ReviewOverview,{phase:1,subNames:n,overall:a.overall,exams:a.exams})),t.push(React.createElement(ReviewFinished,{phase:1,subNames:n,details:a.details,exams:a.exams}))}else if(2==e)if(null==ReportCst.view.middle)t.push(React.createElement("div",{className:"m-tips"},React.createElement("i",null),React.createElement("span",null,"课堂暂未结束，请待课堂结束后再查看。")));else if(0==ReportCst.view.middle.success)t.push(React.createElement("div",{className:"m-tips"},React.createElement("i",null),React.createElement("span",null,ReportCst.view.middle.message)));else{var l=ReportCst.view.middle,r=l.flower,c=l.lessonEval,s=l.teacherEval,i=l.interacts,o=l.tops,m=l.exams,u=l.attendStatInfo,d=l.calleds,h=l.quicks;t.push(React.createElement(BehaviorTimeline,{datas:i})),t.push(React.createElement(LessonEvaluate,{lessonEval:c,teacherEval:s,flower:r})),t.push(React.createElement(LessonTopRank,{datas:o})),t.push(React.createElement(LessonExamInfo,{datas:m})),t.push(React.createElement(LessonAttendance,{attend:u})),t.push(React.createElement(LessonCallInfo,{datas:d})),t.push(React.createElement(LessonQuickInfo,{datas:h}))}else if(null!=ReportCst.view.review){var R=ReportCst.view.review,p=["课件","试卷","笔记"];t.push(React.createElement(ReviewOverview,{phase:3,subNames:p,overall:R.overall,exams:R.exams})),t.push(React.createElement(ReviewFinished,{phase:3,subNames:p,details:R.details,exams:R.exams}))}else t.push(React.createElement("div",{className:"m-tips"},React.createElement("i",null),React.createElement("span",null,"课堂暂未结束，请待课堂结束后再查看。")));var f=ReportCst.view.lesson;return React.createElement("div",{className:"z-classreviewreport"},React.createElement("h3",{className:"tips"},React.createElement("i",{className:"date"}),React.createElement("span",null,LekeDate.format(f.startTime,"yyyy-MM-dd HH:mm")," - ",LekeDate.format(f.endTime,"HH:mm")),React.createElement("span",{className:"f-ml20"},f.subjectName),React.createElement("span",{className:"f-ml20"},f.courseSingleName)),React.createElement("div",{className:"m-tab"},React.createElement("ul",null,React.createElement("li",{className:1==e?"active":"",onClick:this.handleTabChange.bind(this,1)},React.createElement("a",{href:"javascript:void(0);"},"预习检查")),React.createElement("li",{className:2==e?"active":"",onClick:this.handleTabChange.bind(this,2)},React.createElement("a",{href:"javascript:void(0);"},"课堂报告")),React.createElement("li",{className:3==e?"active":"",onClick:this.handleTabChange.bind(this,3)},React.createElement("a",{href:"javascript:void(0);"},"复习检查")))),React.createElement("div",{className:"content"},t))}}]),t}(React.Component),conatiner=document.getElementById("container");ReactDOM.render(React.createElement(LessonReportView,{tabIdx:ReportCst.tabIdx}),container);
});