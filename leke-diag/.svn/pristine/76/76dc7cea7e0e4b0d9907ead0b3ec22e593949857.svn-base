define(function (require, exports, module) {
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function renderLekeVal(e,t,a){return(e[t]?e[t]:0)+(e[a]?e[a]:0)}function colored(e){return React.createElement("span",{className:"colored"},e)}var _class,_temp,_createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),React=require("common/react/react"),ReactDOM=require("common/react/react-dom"),$=require("jquery"),_require=require("common/react/react-utils"),cx=_require.cx,ReactChart=require("common/react/ReactChart"),ReactPieChart=require("../common/ReactPieChart"),Section=require("../common/Section"),BehaviorChartConfig=require("./BehaviorChartConfig"),_require2=require("../utils/number"),toFixed=_require2.toFixed,toRate=_require2.toRate,Dialog=require("dialog"),ScoreReportQuery=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={typeIdx:0,zoneIdx:0,cycleId:e.types[0].list[0].id},a.handleChangeCycle=a.handleChangeCycle.bind(a),a.handleChangeZone=a.handleChangeZone.bind(a),a}return _inherits(t,e),_createClass(t,[{key:"handleClickType",value:function(e){if(this.state.typeIdx!=e){var t=this.props.types[e].list[0].id;this.setState({typeIdx:e,cycleId:t}),this.handleChange(this.state.zoneIdx,t)}}},{key:"handleChangeCycle",value:function(e){var t=parseInt(e.target.value);this.setState({cycleId:t}),this.handleChange(this.state.zoneIdx,t)}},{key:"handleChangeZone",value:function(e){var t=parseInt(e.target.value);this.setState({zoneIdx:t}),this.handleChange(t,this.state.cycleId)}},{key:"handleChange",value:function(e,t){if(this.props.onChange){var a=this.props.zones[e];this.props.onChange(a.classId,a.subjectId,t)}}},{key:"componentDidMount",value:function(){var e=this.state,t=e.zoneIdx,a=e.cycleId;this.handleChange(t,a)}},{key:"render",value:function(){var e=this,t=this.state,a=t.typeIdx,n=t.cycleId,l=this.props,r=l.types,c=l.zones,i=l.hideZone;return React.createElement("div",{className:"m-search-box"},React.createElement("div",{className:"f-fl"},React.createElement("ul",null,r.map(function(t,n){var l=e.handleClickType.bind(e,n);return React.createElement("li",{key:n,className:cx({active:n==a})},React.createElement("a",{onClick:l},t.label))}))),React.createElement("div",{className:"f-fr"},React.createElement("select",{className:"u-select u-select-lg",onChange:this.handleChangeCycle,value:n},r[a].list.map(function(e,t){return React.createElement("option",{key:t,value:e.id},e.label)})),React.createElement("select",{className:cx("u-select u-select-lg",{"f-dn":i||!1}),onChange:this.handleChangeZone},c.map(function(e,t){return React.createElement("option",{key:t,value:t},e.label)}))))}}]),t}(React.Component),PersonSummary=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.userName,a=e.summaryInfo,n=a.totalNum,l=a.attendRate,r=a.previewRate,c=a.reviewRate,i=a.submitRate,s=a.bugFixRate,o=a.achieveNum,u=a.lekeNum;return React.createElement("div",{className:"summary"},React.createElement("p",null,"亲爱的",React.createElement("span",{className:"colored"},t),"同学："),React.createElement("p",{className:"details"},"在此期间内，您应上课堂",colored(n),"节，出勤率",colored(l+"%"),"； 预/复习比率分别为",colored(r+"%"),"，",colored(c+"%"),"； 作业提交率",colored(i+"%"),"，订正率",colored(s+"%"),"； 共取得",colored(o),"项成就，获得乐豆",colored(u),"； 请努力学习，有付出就有收获。"))}}]),t}(React.Component),DiligentInfo=(_temp=_class=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"buildGaugeOption",value:function(e){var a=Math.floor(e/20);return{series:[{type:"gauge",radius:"90%",data:[{name:t.achieveLevels[a],value:e}],axisLine:{lineStyle:{color:[[.2,"#7bb57b"],[.8,"#85c6f4"],[1,"#ffac8e"]]}}}]}}},{key:"buildLineOptions",value:function(e){return{color:["#76b3a1"],title:{text:"勤奋指数走势",left:"center",textStyle:{fontWeight:"normal"}},tooltip:{trigger:"item",formatter:"{b}：{c}"},grid:{left:"3%",right:"3%",bottom:"8%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e.map(function(e){return e.name.replace(/（\S*）/,"")})},yAxis:{type:"value"},series:[{type:"line",areaStyle:{normal:{}},data:e.map(function(e){return e.value})}]}}},{key:"render",value:function(){var e=this.props.view.achievement,t=e.trends,a=e.score;return React.createElement(Section,{id:this.props.id,title:"勤奋指数",help:Leke.domain.staticServerName+"/pages/help-center/diag/kq-zs.html"},React.createElement("div",{className:"c-layout"},React.createElement("div",{className:"left",style:{width:"40%"}},React.createElement(ReactChart,{className:"maps",option:this.buildGaugeOption(a)})),React.createElement("div",{className:"right",style:{width:"50%"}},React.createElement(ReactChart,{className:"maps",option:this.buildLineOptions(t)}))),React.createElement("div",{className:"tips"},"勤奋指数共有5个层级分别是：[80-100]为非常勤奋，[60-80)为很勤奋，[40-60)为较勤奋，[20-40)为不够勤奋，[0-20)为不勤奋。"))}}]),t}(React.Component),_class.achieveLevels=["不勤奋","不够勤奋","较勤奋","很勤奋","非常勤奋","非常勤奋"],_temp),Achieves=[[1,"allthework","全勤"],[2,"preview","提前预习"],[3,"listen","专心听讲"],[4,"hardworking","勤思好问"],[5,"active","活跃分子"],[11,"succeed","榜上有名"],[6,"help f-ml50 f-pl50","手有余香"],[7,"earnest","及时改错"],[8,"positive","不磨蹭"],[9,"intelligent","练习达人"],[10,"study","温故知新"]],AchievementInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"handleHelp",value:function(){Dialog.open({title:"帮助",url:Leke.domain.staticServerName+"/pages/help-center/diag/stu-behavior.html"})}},{key:"render",value:function(){var e=this.props.achievement.types;return React.createElement("div",null,React.createElement("p",{className:"tittle"},React.createElement("span",null,"成就"),React.createElement("span",{className:"achievementtips",style:{fontWeight:"normal"}},React.createElement("i",null,"*")," 点亮表示已获得此成就，灰色表示暂未获得此成就 "),React.createElement("i",{className:"help",onClick:this.handleHelp})),React.createElement("div",{className:"achievement"},React.createElement("ul",null,Achieves.map(function(t,a){var n=e.indexOf(t[0])>=0?"":"lighten";return React.createElement("li",{key:a,className:t[1]+" "+n},React.createElement("i",null),t[2])}))))}}]),t}(React.Component),AttendStatInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.attendStatInfo,t=e.lessonNum,a=e.realNum,n=e.normalNum,l=e.belateNum,r=e.earlyNum,c=e.exceptNum,i=e.absentNum,s=[{value:n,name:"全勤"},{value:l,name:"迟到"},{value:r,name:"早退"},{value:c,name:"迟到且早退"},{value:i,name:"缺勤"}],o=["#83cf0b","#619eed","#70cfff","#ffd270","#ff6d6e"],u='应上课<span class="green-txt">'+t+"</span>堂，";return u+='实上<span class="green-txt">'+a+"</span>堂，",u+='上课率<span class="green-txt">'+toRate(a,t)+"%</span>。",React.createElement(Section,{id:this.props.id,title:"考勤",help:Leke.domain.staticServerName+"/pages/help-center/diag/kq-sk.html"},React.createElement(ReactPieChart,{datas:s,summary:u,color:o,unit:"堂"}))}}]),t}(React.Component),ClassInteractInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.behaviorInfo,t=this.props.attendStatInfo,a=this.props.lekeVal;return React.createElement(Section,{id:this.props.id,title:"课堂行为",detail:"person-behavior-interact.htm?cycleId="+this.props.cycleId},React.createElement("div",{className:"m-table m-table-center"},React.createElement("table",null,React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",null,"互动行为"),React.createElement("th",null,"数量"),React.createElement("th",null,"获得乐币")),React.createElement("tr",null,React.createElement("td",null,"金榜题名"),React.createElement("td",null,e.rank1,"/",e.rank2,"/",e.rank3," ","hd"==Leke.device?null:React.createElement("i",{className:"c-help f-csp",title:"”a/b/c“分别代表获得状元、榜眼、探花的课堂数"})),React.createElement("td",null,renderLekeVal(a,"12302"))),React.createElement("tr",null,React.createElement("td",null,"点到"),React.createElement("td",null,e.callNum1,"/",e.callNum2),React.createElement("td",null,renderLekeVal(a,"12306"))),React.createElement("tr",null,React.createElement("td",null,"举手"),React.createElement("td",null,e.raised),React.createElement("td",null,renderLekeVal(a,"12103"))),React.createElement("tr",null,React.createElement("td",null,"被授权"),React.createElement("td",null,e.authed),React.createElement("td",null,"--")),React.createElement("tr",null,React.createElement("td",null,"课堂笔记"),React.createElement("td",null,e.noteNum),React.createElement("td",null,renderLekeVal(a,"12105"))),React.createElement("tr",null,React.createElement("td",null,"随堂作业"),React.createElement("td",null,e.examNum1,"/",e.examNum2),React.createElement("td",null,"--")),React.createElement("tr",null,React.createElement("td",null,"快速问答"),React.createElement("td",null,e.quickNum1,"/",e.quickNum2),React.createElement("td",null,"--")),React.createElement("tr",null,React.createElement("td",null,"分组讨论"),React.createElement("td",null,e.discuNum1,"/",e.discuNum2),React.createElement("td",null,renderLekeVal(a,"12307","12308"))),React.createElement("tr",null,React.createElement("td",null,"献花"),React.createElement("td",null,e.flowerNum),React.createElement("td",null,renderLekeVal(a,"12107"))),React.createElement("tr",null,React.createElement("td",null,"评价"),React.createElement("td",null,e.evalNum,"/",t.realNum),React.createElement("td",null,renderLekeVal(a,"12104")))))))}}]),t}(React.Component),ViewFinishAnalyInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.viewFinishAnaly,t=[{name:"课件",max:e.totalNum},{name:"微课",max:e.totalNum},{name:"试卷",max:e.totalNum}],a=[{name:"试卷",max:e.totalNum},{name:"课件",max:e.totalNum},{name:"笔记",max:e.totalNum}],n=[{name:"应预习",value:e.previews1},{name:"实预习",value:e.previews2}],l=[{name:"应复习",value:e.reviews1},{name:"实复习",value:e.reviews2}];return React.createElement("div",{className:"classsituation"},React.createElement("p",{className:"tittle"},"预复习情况"),React.createElement("div",{className:"reportform f-pr"},React.createElement(ReactChart,{style:{height:360},option:BehaviorChartConfig.buildGeneralRadar(t,n)})),React.createElement("div",{className:"reportform"},React.createElement(ReactChart,{style:{height:360},option:BehaviorChartConfig.buildGeneralRadar(a,l)})),React.createElement("div",{className:"m-table m-table-center f-cb"},React.createElement("table",null,React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",null,"总课堂数"),React.createElement("th",null,"可预习课堂数"),React.createElement("th",null,"实预习(比率)"),React.createElement("th",null,"可复习课堂数"),React.createElement("th",null,"实复习(比率)")),React.createElement("tr",null,React.createElement("td",null,e.totalNum),React.createElement("td",null,e.preview1),React.createElement("td",null,e.preview2,"（",toRate(e.preview2,e.preview1),"%）"),React.createElement("td",null,e.review1),React.createElement("td",null,e.review2,"（",toRate(e.review2,e.review1),"%）"))))))}}]),t}(React.Component),WorkFinishAnalyInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.workFinishAnaly,t=e.totalNum,a=e.normalNum,n=e.delayNum,l=e.doneBugFixNum,r=e.undoBugFixNum,c=t-a-n,i=l+r,s="应交作业："+t,o=[{name:"正常提交",value:a},{name:"延迟提交",value:n},{name:"未提交",value:c}],u="应订正作业："+i,m=[{name:"已订正",value:l},{name:"未订正",value:r}];return React.createElement("div",{className:"classsituation"},React.createElement("p",{className:"tittle"},"作业情况"),React.createElement("div",{className:"reportform"},React.createElement("h3",{className:"title f-tac f-pr"},"完成情况 ",React.createElement("a",{href:"person-behavior-homework.htm?cycleId="+this.props.cycleId,target:"_blank",className:"detailslable"},"详情",React.createElement("i",null))),React.createElement("div",{className:"f-pr"},React.createElement(ReactChart,{style:{height:360},option:BehaviorChartConfig.buildGeneralPie(s,o)}))),React.createElement("div",{className:"reportform"},React.createElement("p",{className:"title f-tac"},"订正情况"),React.createElement("div",{className:"f-pr"},React.createElement(ReactChart,{style:{height:360},option:BehaviorChartConfig.buildGeneralPie(u,m)}))))}}]),t}(React.Component),OtherBehaviorInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.lekeVal,t=this.props.otherWiseInfo,a=t.practiceNum,n=t.killWrongNum,l=t.writeNoteNum,r=t.doubtNum;return React.createElement("div",null,React.createElement("p",{className:"tittle"},"其它学习行为汇总"),React.createElement("div",{className:"m-table m-table-center"},React.createElement("table",null,React.createElement("tbody",null,React.createElement("tr",null,React.createElement("th",null,"项目"),React.createElement("th",null,"自主练习"),React.createElement("th",null,"消灭错题"),React.createElement("th",null,"课外笔记"),React.createElement("th",null,"提问")),React.createElement("tr",null,React.createElement("td",null,"数量"),React.createElement("td",null,a,"题"),React.createElement("td",null,n,"题"),React.createElement("td",null,l,"份"),React.createElement("td",null,r,"次")),React.createElement("tr",null,React.createElement("td",null,"获得乐豆"),React.createElement("td",null,renderLekeVal(e,"11301")),React.createElement("td",null,renderLekeVal(e,"11304")),React.createElement("td",null,"--"),React.createElement("td",null,renderLekeVal(e,"11302")))))))}}]),t}(React.Component),PersonBehavior=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={loading:!1,cycleId:null,view:null},a.handleChangeQuery=a.handleChangeQuery.bind(a),a}return _inherits(t,e),_createClass(t,[{key:"handleChangeQuery",value:function(e,t,a){this.setState({loading:!0}),$.post("person-behavior-data.htm",{classId:e,subjectId:t,cycleId:a}).done(function(e){this.setState({loading:!1,cycleId:a,view:e.datas.view})}.bind(this))}},{key:"renderBody",value:function(){var e=this.state,t=e.cycleId,a=e.loading,n=e.view;return null==n||1==a?React.createElement("div",{className:"m-mask"},React.createElement("div",{className:"con"},React.createElement("i",null),React.createElement("div",null,"数据加载中"))):0==n.success?React.createElement("div",{className:"m-tips"},React.createElement("i",null),React.createElement("span",null,n.message)):React.createElement("div",{className:"c-syn-subj"},React.createElement(PersonSummary,{summaryInfo:n.summaryInfo,userName:Csts.userName}),React.createElement(DiligentInfo,{view:n}),React.createElement(AchievementInfo,{achievement:n.achievement,lekeVal:n.lekeVal}),React.createElement(AttendStatInfo,{attendStatInfo:n.attendStatInfo}),React.createElement(ClassInteractInfo,{behaviorInfo:n.behaviorInfo,attendStatInfo:n.attendStatInfo,lekeVal:n.lekeVal,cycleId:t}),React.createElement(ViewFinishAnalyInfo,{viewFinishAnaly:n.viewFinishAnaly}),React.createElement(WorkFinishAnalyInfo,{workFinishAnaly:n.workFinishAnaly,cycleId:t}),React.createElement(OtherBehaviorInfo,{otherWiseInfo:n.otherWiseInfo,lekeVal:n.lekeVal}))}},{key:"render",value:function(){var e=Csts,t=e.types,a=e.zones;e.mode,e.view,e.userName;return React.createElement("div",{className:"analysis"},React.createElement(ScoreReportQuery,{types:t,zones:a,hideZone:!0,onChange:this.handleChangeQuery}),this.renderBody())}}]),t}(React.Component);ReactDOM.render(React.createElement(PersonBehavior,null),document.getElementById("app"));
});