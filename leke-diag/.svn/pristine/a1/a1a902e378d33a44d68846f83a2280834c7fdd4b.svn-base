define(function (require, exports, module) {
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),React=require("common/react/react"),ReactDOM=require("common/react/react-dom"),_require=require("common/react/react-utils"),cx=_require.cx,ReactChart=require("common/react/ReactChart"),ReactDataGrid=require("../common/ReactDataGrid"),KnoGraspTable=require("../common/KnoGraspTable"),MicroView=require("../common/MicroView"),ScoreChartConfig=require("./ScoreChartConfig"),_require2=require("./helper"),toFixed=_require2.toFixed,toRate=_require2.toRate,toSecond=_require2.toSecond,toLevel=_require2.toLevel,toLevelName=_require2.toLevelName,Dialog=require("dialog"),SummaryInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.summary,a=e.userName,r=e.totalScore,o=e.myself,c=t.totalNum,n=t.selfUsedTime,s=t.avgUsedTime,l=t.submitRank,i=t.selfScore,m=t.scoreRank;r=toFixed(r);var u=["短于","等于","长于"],d=1;return n>s?d=2:n<s&&(d=0),o?React.createElement("div",{className:"summary"},React.createElement("p",null,"亲爱的",React.createElement("span",{className:"colored"},a),"同学："),React.createElement("p",{className:"details"},"您好，本次作业共有",React.createElement("span",{className:"colored"},c),"位同学参加， 您的作业用时",React.createElement("span",{className:"colored"},toSecond(n)),"分钟，",React.createElement("span",{className:"colored"},u[d]),"班级平均用时， 您第",React.createElement("span",{className:"colored"},l),"个提交， 早于",React.createElement("span",{className:"colored"},toRate(c-l,c,1)),"%的同学， 得分",React.createElement("span",{className:"colored"},toFixed(i,1)),"分（满分",toFixed(r),"分）， 排名第",React.createElement("span",{className:"colored"},m),"， 表现",React.createElement("span",{className:"colored"},toLevelName(toRate(i,r,1))),"， 领先全班",React.createElement("span",{className:"colored"},toRate(c-m,c,1)),"%的同学； 请努力学习，争取更上一层楼。")):React.createElement("div",{className:"summary"},React.createElement("p",{className:"details"},React.createElement("span",{className:"colored"},a),"同学作业用时",React.createElement("span",{className:"colored"},toSecond(n)),"分钟，",React.createElement("span",{className:"colored"},u[d]),"班级平均用时， 第",React.createElement("span",{className:"colored"},l),"个提交， 早于",React.createElement("span",{className:"colored"},toRate(c-l,c,1)),"%的同学， 得分",React.createElement("span",{className:"colored"},toFixed(i,1)),"分（满分",toFixed(r),"分）， 排名第",React.createElement("span",{className:"colored"},m),"， 表现",React.createElement("span",{className:"colored"},toLevelName(toRate(i,r,1))),"， 领先全班",React.createElement("span",{className:"colored"},toRate(c-m,c,1)),"%的同学；"))}}]),t}(React.Component),FinishInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"buildScoreBar",value:function(){var e=this.props.summary,t=e.selfScore,a=e.maxScore,r=e.avgScore;return{color:["#5b9bd5","#8bc036","#ffbe54"],legend:{selectedMode:!1,data:["班级最高分","班级平均分"]},tooltip:{trigger:"axis",formatter:"{a0}：{c0}<br />我的排名："+e.scoreRank+"<br />{a1}：{c1}<br />{a2}：{c2}",axisPointer:{type:"shadow"}},grid:{top:60,left:60,right:60,bottom:0,containLabel:!0},xAxis:[{type:"category",data:[""]}],yAxis:[{type:"value",splitNumber:10,axisLabel:{formatter:"{value} 分"}}],series:[{name:"我的得分",type:"bar",barWidth:60,data:[toFixed(t,1)]},{name:"班级最高分",type:"line",data:[toFixed(a,1)],symbolSize:10,markPoint:{silent:!0,data:[{type:"max",name:"班级最高分"}]}},{name:"班级平均分",type:"line",data:[toFixed(r,1)],symbolSize:10,markPoint:{silent:!0,data:[{type:"min",name:"班级平均分"}]}}]}}},{key:"buildUsedTimeBar",value:function(){var e=this.props.summary,t=e.avgUsedTime,a=e.selfUsedTime;t=toSecond(t),a=toSecond(a);var r=Math.max(t,a);return r=toFixed(1.2*r,1),{color:[t<a?"#d0d0d0":"#33c8af","#ffbe54"],tooltip:{trigger:"axis",formatter:"{a0}：{c0}分钟<br />{a1}：{c1}分钟",axisPointer:{type:"shadow"}},legend:{selectedMode:!1,data:["班级平均用时"]},grid:{top:60,left:60,right:60,bottom:0,containLabel:!0},xAxis:[{type:"category",data:[""]}],yAxis:[{type:"value",max:r,splitNumber:10,axisLabel:{formatter:"{value} 分钟"}}],series:[{name:"我的用时",type:"bar",barWidth:60,data:[a]},{name:"班级平均用时",type:"line",data:[t],symbolSize:10,markPoint:{silent:!0,data:[{type:"max",name:"班级平均用时"}]}}]}}},{key:"render",value:function(){var e=this.props.scoreRanks,t=[0,0,0,0,0];return e.filter(function(e){return e.level<=5}).forEach(function(e){var a=toFixed(100*e.scoreRate,1),r=toLevel(a);t[r-1]++}),React.createElement("div",{className:"donework"},React.createElement("span",{className:"tittle"}),React.createElement("div",{className:"maps"},React.createElement("div",{className:"mapcontainer"},React.createElement(ReactChart,{className:"mapitem left3",option:this.buildScoreBar()}),React.createElement(ReactChart,{className:"mapitem center3",option:this.buildUsedTimeBar()}),React.createElement(ReactChart,{className:"mapitem right3",option:ScoreChartConfig.buildScorePie(t[0],t[1],t[2],t[3],t[4],"人")})),React.createElement("div",{className:"tips"},"等级计算方法： 满分100分作业，85分以上为优秀，[70-85)分为良好，[60-70)分为及格，[45-60)分为较差，45分以下为危险，满分不为100分各等级按相应比例折算。")))}}]),t}(React.Component),QueScoreInfo=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var c=arguments.length,n=Array(c),s=0;s<c;s++)n[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.buildTotal=function(e){var t=0,a=0,r=0,o=0,c=0;e.forEach(function(e){t+=e.qids.length,a+=e.rightNum,r+=e.totalScore,o+=e.classScore,c+=e.selfScore});var n=toRate(c,r,1),s=toRate(o,r,1);return{id:-1,name:"全部",length:t,rightNum:a,totalScore:r,selfScore:c,classScore:o,selfRate:n,classRate:s}},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.queGroups;e.forEach(function(e){e.selfRate=toRate(e.selfScore,e.totalScore,1),e.classRate=toRate(e.classScore,e.totalScore,1)});var t=this.buildTotal(e),a=[{title:"大题",width:"38%",field:"name"},{title:"题数",width:"10%",field:"length",render:function(e,t,a){return e||t.qids.length}},{title:"分值",width:"10%",field:"totalScore",render:function(e,t,a){return toFixed(e,1)}},{title:"正确题数",width:"10%",field:"rightNum",render:function(e,t,a){return toFixed(e,1)}},{title:"得分",width:"10%",field:"selfScore",render:function(e,t,a){return toFixed(e,1)}},{title:"得分率",width:"10%",field:"selfRate",render:function(e,t,a){return toFixed(e,1)+"%"},onSort:!0},{title:"班级得分率",width:"12%",field:"classRate",render:function(e,t,a){return toFixed(e,1)+"%"},onSort:!0}];return React.createElement("div",{className:"mainquestion"},React.createElement("span",{className:"tittle"}),React.createElement(ReactDataGrid,{columns:a,datas:e,total:t}),React.createElement("a",{href:"../../../homework/analysis2.htm?homeworkId="+ReportCst.homeworkId+"&studentId="+ReportCst.userId,target:"_blank",className:"check-rate"},"查看试题得分率 >>"))}}]),t}(React.Component),KnoScoreInfo=function(e){function t(){var e,a,r,o;_classCallCheck(this,t);for(var c=arguments.length,n=Array(c),s=0;s<c;s++)n[s]=arguments[s];return a=r=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n))),r.handleHelpClick=function(){Dialog.open({title:"帮助",url:Leke.domain.staticServerName+"/pages/help-center/diag/zw-cd.html"})},o=a,_possibleConstructorReturn(r,o)}return _inherits(t,e),_createClass(t,[{key:"resolveKnoRates",value:function(e){e.forEach(function(e){e.totalNum=e.qids.length,e.selfRate=toRate(e.selfScore,e.totalScore,1),e.classRate=toRate(e.classScore,e.totalScore,1),e.selfRate>=85?e.level=1:e.selfRate>=50?e.level=2:e.level=3})}},{key:"render",value:function(){var e=this.props,t=e.knoGroups,a=e.myself;if(!t||!t.length)return null;var r=(this.resolveKnoRates(t),"name,totalNum,rightNum,totalScore,selfScore,selfRate,klassRate,level");return r+=a&&"hd"!=ReportCst.device?",wrong,exercise":"",React.createElement("div",{className:"knowledgepoint"},React.createElement("span",{className:"tittle"}),React.createElement("i",{className:"help",onClick:this.handleHelpClick}),React.createElement(KnoGraspTable,{knoRates:t,columns:r}))}}]),t}(React.Component),CourseRecommend=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){if("hd"==ReportCst.device)return null;var e=this.props.datas;return null==e||void 0==e||0==e.length?null:React.createElement("div",{className:"courserecommend"},React.createElement("span",{className:"tittle"}),React.createElement(MicroView,{datas:e}))}}]),t}(React.Component),HomeworkAnalysis=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=ReportCst.view,t=e.summary,a=t.homeworkName,r=t.scoreRank;return React.createElement("div",{className:"analysis"},React.createElement("div",{className:"c-singlepage"},React.createElement("div",{className:"header"},React.createElement("h1",null,ReportCst.myself?"":ReportCst.userName,React.createElement("span",{className:"colored"},"《",a,"》"),"作业分析报告"),r<=3?React.createElement("span",{className:"rankpos rankpos-"+r}):null),React.createElement(SummaryInfo,{summary:e.summary,totalScore:e.totalScore,userName:ReportCst.userName,myself:ReportCst.myself}),React.createElement(FinishInfo,{summary:e.summary,scoreRanks:e.scoreRanks}),React.createElement(QueScoreInfo,{queGroups:e.queGroups}),React.createElement(KnoScoreInfo,{knoGroups:e.knoGroups,myself:ReportCst.myself}),React.createElement(CourseRecommend,{datas:e.micros})))}}]),t}(React.Component);ReactDOM.render(React.createElement(HomeworkAnalysis,null),document.getElementById("container"));
});