define(function (require, exports, module) {
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),React=require("common/react/react"),ReactDOM=require("common/react/react-dom"),$=require("jquery"),JSON=require("json"),Utils=require("utils"),_require=require("common/react/react-utils"),cx=_require.cx,ReactChart=require("common/react/ReactChart"),ScoreChartConfig=require("./ScoreChartConfig"),KnoGraspTable=require("./KnoGraspTable"),_require2=require("./ScoreComponents"),ScoreReportQuery=_require2.ScoreReportQuery,ScoreTrendChart=_require2.ScoreTrendChart,_require3=require("./helper"),toFixed=_require3.toFixed,toRate=_require3.toRate,toLevel=_require3.toLevel,toLevelName=_require3.toLevelName,ClassSummary=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"renderExplain",value:function(e){var t=this.props.summary,a=t.avgScore,r=t.maxScore,n=t.minScore,c=t.totalNum,l=t.otherNum,s=t.levelA,o=t.levelB,i=t.levelC,u=t.levelD,m=t.levelE,p=c-l;return React.createElement("p",{className:"details"},"您好，在此期间，本班级的学科平均分为",React.createElement("span",{className:"colored"},toFixed(a,1)),"分， 最高分",React.createElement("span",{className:"colored"},toFixed(r,1)),"分， 最低分",React.createElement("span",{className:"pointed"},toFixed(n,1)),"分， 班级整体表现",React.createElement("span",{className:"pointed"},toLevelName(a)),"； 本班共有学生",React.createElement("span",{className:"colored"},c),"人， 其中成绩优秀",React.createElement("span",{className:"colored"},s),"人， 占比",React.createElement("span",{className:"colored"},toRate(s,p,1),"%"),"， 良好",React.createElement("span",{className:"colored"},o),"人， 占比",React.createElement("span",{className:"colored"},toRate(o,p,1),"%"),"， 及格",React.createElement("span",{className:"colored"},i),"人， 占比",React.createElement("span",{className:"colored"},toRate(i,p,1),"%"),"， 较差",React.createElement("span",{className:"pointed"},u),"人， 占比",React.createElement("span",{className:"pointed"},toRate(u,p,1),"%"),"， 危险",React.createElement("span",{className:"pointed"},m),"人， 占比",React.createElement("span",{className:"pointed"},toRate(m,p,1),"%"),"。")}},{key:"render",value:function(){var e=this.props.summary,t=e.levelA,a=e.levelB,r=e.levelC,n=e.levelD,c=e.levelE,l=e.avgScore,s=e.maxScore,o=e.minScore;return React.createElement("div",{className:"summary"},React.createElement("p",{className:"tittle"},"成绩分析"),React.createElement("p",null,"敬爱的",React.createElement("span",{className:"colored"},Leke.user.currentUserName),"老师："),this.renderExplain(),React.createElement("div",{className:"maps"},React.createElement("div",{className:"mapcontainer"},React.createElement(ReactChart,{className:"mapitem left2",option:ScoreChartConfig.buildClassScoreBar(l,s,o)}),React.createElement(ReactChart,{className:"mapitem right2",option:ScoreChartConfig.buildScorePie(t,a,r,n,c)}))))}}]),t}(React.Component),ClassRankInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"buildLevel",value:function(e,t,a){var r=this.props.scope;return t=t.filter(function(e){return e.level==a}),t.map(function(n,c){return React.createElement("tr",null,0==c?React.createElement("td",{className:"rankclass-"+a,rowSpan:t.length},e,"(",t.length,"人)"):null,React.createElement("td",null,n.index),React.createElement("td",{className:"operation"},a<=5?React.createElement("a",{href:"./klass-score-detail/"+r+"-"+n.userId+".htm",target:"_blank"},n.userName):React.createElement("span",null,n.userName)),React.createElement("td",null,null!=n.score?toFixed(n.score,1):"--"))})}},{key:"render",value:function(){var e=this,t=["优秀","良好","及格","较差","危险","无成绩"],a=this.props.scoreRanks;a.forEach(function(e,t){e.score=toFixed(e.score,1),e.level=toLevel(e.score)});for(var r=1e4,n=0,c=0;c<a.length;c++){var l=a[c];null!=l.score?(l.score<r&&(n++,r=l.score),l.index=n):l.index="--"}return React.createElement("div",{className:"classrank"},React.createElement("p",{className:"tittle"},"班级成绩排行"),React.createElement("div",{className:"m-table m-table-center"},React.createElement("table",null,React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",{style:{width:150}},"层级"),React.createElement("th",null,"排名"),React.createElement("th",null,"姓名"),React.createElement("th",null,"分数"))),React.createElement("tbody",null,t.map(function(t,r){return e.buildLevel(t,a,r+1)})))),React.createElement("span",{className:"tips"},"注：点击学生姓名可查看该生学习分析报告"))}}]),t}(React.Component),ScoreTrendInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props.trends;return e&&e.length?React.createElement("div",{className:"syn-trend"},React.createElement("p",{className:"tittle"},"班级成长走势"),React.createElement(ScoreTrendChart,{trends:this.props.trends})):null}}]),t}(React.Component),KnoGraspInfo=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"markLevels",value:function(e){e.forEach(function(e){e.classRate>=85?e.level=1:e.classRate>=50?e.level=2:e.level=3})}},{key:"render",value:function(){var e=this.props,t=e.knoRates,a=e.classId,r=e.subjectId;return t&&t.length?(this.markLevels(t),React.createElement("div",{className:"knowledgepoint"},React.createElement("p",{className:"tittle"},"知识点掌握程度"),React.createElement(KnoGraspTable,{knoRates:t,columns:"name,klassRate,level",increase:"hd"!=ReportCst.device,classId:a,subjectId:r}))):null}}]),t}(React.Component),ClassAnalysis=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={loading:!1,scope:null,view:null},a.handleChangeQuery=a.handleChangeQuery.bind(a),a}return _inherits(t,e),_createClass(t,[{key:"handleChangeQuery",value:function(e,t,a){this.setState({loading:!0}),$.post("klass-score-data.htm",{classId:e,subjectId:t,cycleId:a}).done(function(r){this.setState({loading:!1,scope:[e,t,a].join("-"),view:r.datas.view,classId:e,subjectId:t})}.bind(this))}},{key:"renderBody",value:function(){var e=this.state,t=e.loading,a=e.view,r=e.classId,n=e.subjectId;return null==a||1==t?React.createElement("div",{className:"m-mask"},React.createElement("div",{className:"con"},React.createElement("i",null),React.createElement("div",null,"数据加载中"))):0==a.success?React.createElement("div",{className:"m-tips"},React.createElement("i",null),React.createElement("span",null,a.message)):React.createElement("div",{className:"c-syn-subj"},React.createElement(ClassSummary,{summary:a.summary}),React.createElement(ScoreTrendInfo,{trends:a.trends}),React.createElement(ClassRankInfo,{scoreRanks:a.scoreRanks,scope:this.state.scope}),React.createElement(KnoGraspInfo,{knoRates:a.knoRates,classId:r,subjectId:n}))}},{key:"render",value:function(){var e=ReportCst,t=e.types,a=e.zones;if(!a||!a.length)return React.createElement("div",{className:"m-tips"},React.createElement("i",null),React.createElement("span",null,"您暂无关联班级，无数据可供分析！"));var r=this.state.loading?"block":"none";return React.createElement("div",{className:"analysis"},React.createElement(ScoreReportQuery,{types:t,zones:a,onChange:this.handleChangeQuery}),this.renderBody(),React.createElement("div",{className:"m-mask",style:{display:r}},React.createElement("div",{className:"con"},React.createElement("i",null),React.createElement("div",null,"数据加载中"))))}}]),t}(React.Component);ReactDOM.render(React.createElement(ClassAnalysis,null),document.getElementById("container"));
});